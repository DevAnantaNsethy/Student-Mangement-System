<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Your Password</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="./studentogin.css" />
    <!-- Reusing login styles -->
  </head>
  <body>
    <div class="container">
      <div class="login-left">
        <h1>Reset Your Password</h1>
        <p>Enter and confirm your new password.</p>

        <form id="resetForm" onsubmit="return false;">
          <input
            type="password"
            id="password"
            placeholder="New Password"
            required
          />
          <input
            type="password"
            id="confirmPassword"
            placeholder="Confirm New Password"
            required
          />
          <button type="button" id="resetBtn" class="login-btn">
            Reset Password
          </button>
          <div
            class="message-area"
            id="messageArea"
            style="font-size: 1.1em; margin-top: 15px"
          ></div>
        </form>
      </div>
    </div>

    <script>
      const resetBtn = document.getElementById("resetBtn");
      const passwordInput = document.getElementById("password");
      const confirmPasswordInput = document.getElementById("confirmPassword");
      const messageArea = document.getElementById("messageArea");

      // Get the token from the URL
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get("token");

      resetBtn.onclick = async function () {
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        if (!password || !confirmPassword) {
          messageArea.textContent = "Both fields are required.";
          messageArea.style.color = "#ff4d4d";
          return;
        }
        if (password !== confirmPassword) {
          messageArea.textContent = "Passwords do not match.";
          messageArea.style.color = "#ff4d4d";
          return;
        }
        if (!token) {
          messageArea.textContent = "Invalid or missing reset token.";
          messageArea.style.color = "#ff4d4d";
          return;
        }

        messageArea.textContent = "Resetting...";
        messageArea.style.color = "white";
        resetBtn.disabled = true;

        const res = await fetch("/api/reset-password", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token, password }),
        });

        const data = await res.json();

        if (res.ok) {
          messageArea.textContent = data.message + " Redirecting to login...";
          messageArea.style.color = "#4caf50";
          setTimeout(() => {
            window.location.href = "/student-login.html";
          }, 3000);
        } else {
          messageArea.textContent = data.message;
          messageArea.style.color = "#ff4d4d";
          resetBtn.disabled = false;
        }
      };
    </script>
  </body>
</html>
